# TDD 도입 회고 (2026.02.09)

## 프로젝트 정보

- **프로젝트**: portfolio-draft-one (React 19 + TypeScript + Vite)
- **테스트 도구**: Vitest 4 + React Testing Library + jsdom

## 최종 결과

- 테스트 파일: 5개
- 테스트 케이스: 37개
- 실행 시간: ~1.3초
- 프로덕션 코드 버그 발견: 1건 (noValidate 누락)

## 단계별 진행 내역

### 0단계: 테스트 환경 셋업

- Vitest, @testing-library/react, jsdom 등 설치
- `vitest.config.ts` 분리 (Vitest v4에서 vite.config.ts와 별도 관리)
- `src/test/setup.ts`에서 jest-dom 매처 등록
- `package.json`에 `test`, `test:run` 스크립트 추가
- `tsconfig.app.json`에 `vitest/globals` 타입 추가

### 1단계: 유틸리티 / 순수 로직 TDD

**대상**: `cn()` 유틸리티, 프로젝트 필터 로직

**핵심 학습**:

- TDD 사이클 (Red → Green → Refactor) 체험
- `cn()`: 이미 존재하는 함수에 테스트를 추가하는 케이스
- 필터 로직: 테스트를 먼저 작성하고 → 함수를 구현하는 순수 TDD 체험
- `Projects.tsx`에 인라인되어 있던 필터 로직을 `project-filters.ts`로 분리
- mock 데이터로 테스트를 독립적으로 유지하는 방법

**생성 파일**:

- `src/lib/project-filters.ts` — 필터 순수 함수 3개 (getUniqueCompanies, getTechStacksByFrequency, filterProjects)
- `src/lib/__tests__/utils.test.ts` — cn() 테스트 5개
- `src/lib/__tests__/project-filters.test.ts` — 필터 로직 테스트 9개

**인사이트**: "테스트하기 어려운 코드 = 설계를 개선할 여지가 있는 코드". 테스트를 위해 로직을 분리하면, 결과적으로 컴포넌트는 UI에만 집중하는 더 좋은 구조가 된다.

### 2단계: 커스텀 훅 TDD

**대상**: `useTheme` 커스텀 훅

**핵심 학습**:

- `renderHook()`: 컴포넌트 없이 훅만 단독 실행
- `act()`: 상태 변경 완료를 대기하는 래퍼
- `vi.fn()`: 가짜 함수 생성 (호출 여부, 인자 추적)
- 브라우저 API mock: `window.matchMedia`, `localStorage`, `document.documentElement.classList`를 가짜로 교체
- `beforeEach()`: 각 테스트 전 환경 초기화로 테스트 격리 보장

**생성 파일**:

- `src/hooks/__tests__/use-theme.test.ts` — useTheme 훅 테스트 12개

**인사이트**: 이미 컴포넌트와 분리된 커스텀 훅은 테스트하기 좋은 구조. TDD 관점에서 로직을 훅으로 분리하는 것의 가치를 체감.

### 3단계-A: ContactFormModal 폼 유효성 테스트

**대상**: ContactFormModal 컴포넌트 (react-hook-form 연동)

**핵심 학습**:

- `render()`: 컴포넌트를 jsdom에 실제 렌더링
- `screen.getByLabelText()`, `screen.getByRole()`: 접근성 속성으로 요소 탐색
- `userEvent.setup()` + `user.click()`, `user.type()`: 실제 사용자 행동 시뮬레이션
- `waitFor()`: 비동기 유효성 검증 결과를 대기
- `vi.mock()`: emailjs, sonner 모듈 전체를 가짜로 교체

**프로덕션 코드 버그 발견**:

- `<form>` 태그에 `noValidate` 속성이 누락되어 있었음
- HTML5 네이티브 검증과 react-hook-form 검증이 충돌
- 테스트가 이 문제를 발견 → `noValidate` 추가로 수정

**생성 파일**:

- `src/components/__tests__/ContactFormModal.test.tsx` — 폼 유효성 테스트 5개

**인사이트**: 테스트가 프로덕션 코드의 실제 버그를 발견한 사례. 테스트를 우회하지 않고 근본 원인을 수정하는 것이 올바른 방향.

### 3단계-B: ThemeToggle 컴포넌트 인터랙션 테스트

**대상**: ThemeToggle 컴포넌트

**핵심 학습**:

- 통합 테스트: useTheme 훅을 mock하지 않고 실제 훅과 함께 테스트
- 버튼 클릭 → 훅 상태 변경 → DOM 반영 → localStorage 저장까지 전체 흐름 검증
- `aria-pressed` 속성으로 활성 상태 검증 (CSS 클래스 대신 의미 기반 검증)

**생성 파일**:

- `src/components/__tests__/ThemeToggle.test.tsx` — 테마 토글 테스트 6개

**인사이트**: 접근성을 잘 구현한 코드는 테스트하기도 쉽다. `aria-pressed`, `aria-label`, `role` 같은 접근성 속성이 테스트에서 안정적인 선택자 역할을 한다.

## TDD가 이 프로젝트에 준 가치

### 코드 구조 개선

- `Projects.tsx` 인라인 로직 → `project-filters.ts` 순수 함수 분리
- 컴포넌트는 UI에만 집중, 로직은 독립적으로 재사용/검증 가능

### 실제 버그 발견

- `ContactFormModal`의 `noValidate` 누락 → react-hook-form과 HTML5 네이티브 검증 충돌 수정

### 실무 적용 가능한 패턴 습득

| 상황 | 접근 방식 |
|------|----------|
| 유틸/로직 함수 신규 개발 | 테스트 먼저 (순수 TDD) |
| 버그 수정 | 버그를 재현하는 테스트 먼저 → 수정 (Regression TDD) |
| 기존 코드 리팩토링 | 테스트 먼저 추가 → 안전하게 리팩토링 |
| 폼 유효성, 필터링, 상태 토글 | 이번에 작성한 패턴 그대로 적용 가능 |

## 테스트 파일 구조

```
src/
├── lib/
│   ├── utils.ts
│   ├── project-filters.ts          ← 신규 (필터 로직 분리)
│   └── __tests__/
│       ├── utils.test.ts            ← 5 tests
│       └── project-filters.test.ts  ← 9 tests
├── hooks/
│   ├── use-theme.ts
│   └── __tests__/
│       └── use-theme.test.ts        ← 12 tests
├── components/
│   ├── ContactFormModal.tsx
│   ├── ThemeToggle.tsx
│   └── __tests__/
│       ├── ContactFormModal.test.tsx ← 5 tests
│       └── ThemeToggle.test.tsx      ← 6 tests
└── test/
    └── setup.ts                     ← jest-dom 매처 등록
```
